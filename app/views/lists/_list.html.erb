<% active = GlobalID::Locator.locate(list.active_playables[user.id]) %>

<%= turbo_frame_tag list do %>
  <%= content_tag :div, class: "border border-dashed border-2 border-gray-400 p-4" do %>
    <tapestry-element maxduration="<%= list.max_duration %>" items="<%= list.playables.map { |entry| {id: entry.id, duration: entry.listable.duration.in_minutes, color: ["#F87171", "#34D399", "#F472B6", "#4ADE80", "#38BDF8", "#818CF8"].sample} }.to_json %>" listid="<%= list.id %>" activeid="<%= active&.id %>"></tapestry-element>
  <% end %>

  <%= form_with(model: list, url: active_playable_list_path(list), id: dom_id(list, :active_playable)) do |f| %>
    <%= f.hidden_field :active_playable_id, {value: active.id} %>
  <% end %>

  <%= turbo_frame_tag "active_playable", src: list_playable_url(list, active) if active.present? %>
<% end %>
